!function(){"use strict";function t(t,e){const s=document.createElement("canvas");return s.width=t,s.height=e,s.getContext("2d")}class e{constructor(t,e,s,i,r,n){this.trimmed=!1,this.texture=t,this.key=e,this.x=s,this.y=i,this.width=r,this.height=n,this.sourceSizeWidth=r,this.sourceSizeHeight=n,this.updateUVs()}setPivot(t,e){this.pivot={x:t,y:e}}setSize(t,e){this.width=t,this.height=e,this.sourceSizeWidth=t,this.sourceSizeHeight=e,this.updateUVs()}setSourceSize(t,e){this.sourceSizeWidth=t,this.sourceSizeHeight=e}setTrim(t,e,s,i,r,n){this.trimmed=!0,this.sourceSizeWidth=t,this.sourceSizeHeight=e,this.spriteSourceSizeX=s,this.spriteSourceSizeY=i,this.spriteSourceSizeWidth=r,this.spriteSourceSizeHeight=n}updateUVs(){const{x:t,y:e,width:s,height:i}=this,r=this.texture.width,n=this.texture.height;this.u0=t/r,this.v0=e/n,this.u1=(t+s)/r,this.v1=(e+i)/n}}let s;var i={get:function(){return s},set:function(t){s=t}};function r(t){const e=i.get();e.isTexture(t)&&e.deleteTexture(t)}function n(t,e,s,r=!0,n=!0){const h=i.get(),a=h.createTexture();h.activeTexture(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,a),h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),t?(h.texImage2D(h.TEXTURE_2D,0,h.RGBA,h.RGBA,h.UNSIGNED_BYTE,t),e=t.width,s=t.height):h.texImage2D(h.TEXTURE_2D,0,h.RGBA,e,s,0,h.RGBA,h.UNSIGNED_BYTE,null);const o=n?h.LINEAR:h.NEAREST;h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,o),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,o);const u=t&&
/**
     * @author       Richard Davey <rich@photonstorm.com>
     * @copyright    2020 Photon Storm Ltd.
     * @license      {@link https://opensource.org/licenses/MIT|MIT License}
     */
function(t,e){return!(t<1||e<1)&&(0==(t&t-1)&&0==(e&e-1))}(e,s),c=u&&r?h.REPEAT:h.CLAMP_TO_EDGE;return h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,c),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,c),u&&h.generateMipmap(h.TEXTURE_2D),a}class h{constructor(t,e,s){this.key="",this.glIndex=0,this.glIndexCounter=-1,t&&(e=t.width,s=t.height),this.image=t,this.width=e,this.height=s,this.frames=new Map,this.data={},this.add("__BASE",0,0,e,s)}add(t,s,i,r,n){if(this.frames.has(t))return null;let h=new e(this,t,s,i,r,n);return this.frames.set(t,h),this.firstFrame&&"__BASE"!==this.firstFrame.key||(this.firstFrame=h),h}get(t){if(!t)return this.firstFrame;t instanceof e&&(t=t.key);let s=this.frames.get(t);return s||(console.warn("Texture.frame missing: "+t),s=this.firstFrame),s}getFrames(t){const e=[];return t.forEach(t=>{e.push(this.get(t))}),e}getFramesInRange(t,e,s,i=0,r=""){const n=[],h=e<s?1:-1;s+=h;for(let a=e;a!==s;a+=h)n.push(t+a.toString().padStart(i,"0")+r);return this.getFrames(n)}setSize(t,e){this.width=t,this.height=e,this.frames.get("__BASE").setSize(t,e)}setFilter(t){!function(t,e=!0){const s=i.get();s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,t);const r=e?s.LINEAR:s.NEAREST;s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,r),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,r)}(this.glTexture,t)}createGL(){this.glTexture&&r(this.glTexture),this.glTexture=n(this.image)}updateGL(){this.glTexture?function(t,e,s=!1){const r=i.get(),n=t.width,h=t.height;n>0&&h>0&&(r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,e),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,s),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t))}(this.image,this.glTexture):this.glTexture=n(this.image)}destroy(){this.frames.clear(),this.image=null,this.firstFrame=null,this.data=null,r(this.glTexture),function(t){const e=i.get();e.isFramebuffer(t)&&e.deleteFramebuffer(t)}(this.glFramebuffer)}}function a(t,e,s,i){const r=t.texture;r.glIndexCounter<i&&e.requestTexture(r),s.count===s.batchSize&&s.flush(),t.uploadBuffers(s.vertexViewF32,s.vertexViewU32,s.count*s.quadElementSize),s.count++}
/**
     * @author       Richard Davey <rich@photonstorm.com>
     * @copyright    2020 Photon Storm Ltd.
     * @license      {@link https://opensource.org/licenses/MIT|MIT License}
     */
class o{constructor(t=0,e=0,s=0,i=0){this.set(t,e,s,i)}set(t=0,e=0,s=0,i=0){return this.x=t,this.y=e,this.width=s,this.height=i,this}contains(t,e){
/**
     * @author       Richard Davey <rich@photonstorm.com>
     * @copyright    2020 Photon Storm Ltd.
     * @license      {@link https://opensource.org/licenses/MIT|MIT License}
     */
return function(t,e,s){return!(t.width<=0||t.height<=0)&&(t.x<=e&&t.x+t.width>=e&&t.y<=s&&t.y+t.height>=s)}(this,t,e)}set right(t){t<=this.x?this.width=0:this.width=t-this.x}get right(){return this.x+this.width}set bottom(t){t<=this.y?this.height=0:this.height=t-this.y}get bottom(){return this.y+this.height}}var u=0,c=1,l=2,d=3,f=4,x=5,m=6,T=7,g=8;class v{constructor(t=1,e=0,s=0,i=1,r=0,n=0){this.set(t,e,s,i,r,n)}set(t=1,e=0,s=0,i=1,r=0,n=0){return this.a=t,this.b=e,this.c=s,this.d=i,this.tx=r,this.ty=n,this}identity(){return this.set()}toArray(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]}fromArray(t){return this.set(t[0],t[1],t[2],t[3],t[4],t[5])}[Symbol.iterator](){return this.toArray()[Symbol.iterator]()}}class p extends class extends class{constructor(){this.name="",this.type="GameObject",this.willRender=!0,this.willUpdate=!0,this.dirtyRender=!0,this.dirtyUpdate=!0,this.dirtyFrame=0,this.isParent=!1,this.visible=!0,this.inputEnabled=!1,this.inputEnabledChildren=!0,this.fixBounds=!1,this.bounds=new o}isRenderable(){return this.visible&&this.willRender}setDirtyRender(t=!0){this.dirtyRender=!0;const e=this.scene;return t&&e&&(this.dirtyFrame=e.game.frame),this}setDirtyUpdate(){return this.dirtyUpdate=!0,this}getBounds(t=!1){return this.bounds}setBounds(t,e,s,i){return this.bounds.set(t,e,s,i),this}update(){}updateTransform(){return this}render(){}destroy(t){this.scene=null}}{constructor(t=0,e=0){super();const s=Float32Array.BYTES_PER_ELEMENT,i=new ArrayBuffer(10*s);this.transformBuffer=i,this.transformData=new Float32Array(i,0,10),this.localTransform=new v,this.worldTransform=new v,this.transformData.set([t,e,.5,.5,0,0,1,1,0,0]),this.width=0,this.height=0,this.updateCache()}updateCache(){const t=this.localTransform,{rotation:e,skewX:s,skewY:i,scaleX:r,scaleY:n,x:h,y:a}=this;return t.set(Math.cos(e+i)*r,Math.sin(e+i)*r,-Math.sin(e-s)*n,Math.cos(e-s)*n,h,a),this.updateTransform()}updateTransform(){this.setDirtyRender();const t=this.parent,e=this.localTransform,s=this.worldTransform;if(e.tx=this.x,e.ty=this.y,!t)return i=e,s.set(i.a,i.b,i.c,i.d,i.tx,i.ty),this;var i;const{a:r,b:n,c:h,d:a,tx:o,ty:u}=e,{a:c,b:l,c:d,d:f,tx:x,ty:m}=t.worldTransform;return s.set(r*c+n*d,r*l+n*f,h*c+a*d,h*l+a*f,o*c+u*d+x,o*l+u*f+m),this}setSize(t,e){return this.width=t,this.height=e,this}setOrigin(t,e=t){const s=this.transformData;return s[l]=t,s[d]=e,this}setPosition(t,e=t){const s=this.transformData;return s[u]=t,s[c]=e,this.updateTransform()}setRotation(t){const e=this.transformData;return t!==e[g]&&(e[g]=t,this.updateCache()),this}setScale(t,e=t){const s=this.transformData;return s[m]=t,s[T]=e,this.updateCache()}setSkew(t,e=t){const s=this.transformData;return s[f]=t,s[x]=e,this.updateCache()}destroy(){super.destroy(),this.localTransform=null,this.worldTransform=null,this.transformBuffer=null,this.transformData=null}set x(t){this.transformData[u]=t,this.updateTransform()}get x(){return this.transformData[u]}set y(t){this.transformData[c]=t,this.updateTransform()}get y(){return this.transformData[c]}get originX(){return this.transformData[l]}set originX(t){this.transformData[l]=t}get originY(){return this.transformData[d]}set originY(t){this.transformData[d]=t}set skewX(t){const e=this.transformData;t!==e[f]&&(e[f]=t,this.updateCache())}get skewX(){return this.transformData[f]}set skewY(t){const e=this.transformData;t!==e[x]&&(e[x]=t,this.updateCache())}get skewY(){return this.transformData[x]}set scaleX(t){const e=this.transformData;t!==e[m]&&(e[m]=t,this.updateCache())}get scaleX(){return this.transformData[m]}set scaleY(t){const e=this.transformData;t!==e[T]&&(e[T]=t,this.updateCache())}get scaleY(){return this.transformData[T]}set rotation(t){const e=this.transformData;t!==e[g]&&(e[g]=t,this.updateCache())}get rotation(){return this.transformData[g]}}{constructor(t=0,e=0){super(t,e),this._alpha=1,this.children=[],this.isParent=!0,this.type="Container"}update(t,e){const s=this.children;for(let i=0;i<s.length;i++){let r=s[i];r&&r.willUpdate&&r.update(t,e)}}destroy(t){this.children=null,super.destroy()}get numChildren(){return this.children.length}get alpha(){return this._alpha}set alpha(t){t!==this._alpha&&(this._alpha=t,this.setDirtyRender())}}function E(t,...e){e.forEach(e=>{let s=e.texture.get(t);if(s===e.frame)return;e.frame=s,e.setSize(s.sourceSizeWidth,s.sourceSizeHeight),e.setBounds(e.x,e.y,e.width,e.height),s.pivot&&e.setOrigin(s.pivot.x,s.pivot.y);let i=e.vertexData;i[2]=s.u0,i[3]=s.v0,i[8]=s.u0,i[9]=s.v1,i[14]=s.u1,i[15]=s.v1,i[20]=s.u1,i[21]=s.v0,e.setDirtyRender(),e.hasTexture=!0})}let y;var w={get:function(){return y},set:function(t){y=t}};class R extends p{constructor(t,e,s,i){super(t,e),this.hasTexture=!1,this._tint=16777215,this._prevTextureID=-1,this.vertexData=new Float32Array(24).fill(0),this.vertexColor=new Uint32Array(4).fill(4294967295),this.vertexAlpha=new Float32Array(4).fill(1),this.vertexTint=new Uint32Array(4).fill(16777215),this.type="Sprite",this.setTexture(s,i),this.setBounds(t,e,this.width,this.height)}getBounds(t=!1){return this.dirtyRender&&this.updateVertices(),super.getBounds(t),this.bounds}setTexture(t,e){return function(t,e,...s){s.forEach(s=>{t&&(s.texture=t instanceof h?t:w.get().textures.get(t),s.texture?(s.texture.glTexture||s.texture.createGL(),E(e,s)):console.warn("Invalid Texture key: "+t))})}(t,e,this),this}setFrame(t){return E(t,this),this}isRenderable(){return this.visible&&this.willRender&&this.hasTexture&&this.alpha>0}updateVertices(){const t=this.vertexData;this.dirtyRender=!1;const e=this.frame,s=this.originX,i=this.originY;let r,n,h,a;const[o,u,c,l,d,f]=this.worldTransform;e.trimmed?(n=e.spriteSourceSizeX-s*e.sourceSizeWidth,r=n+e.spriteSourceSizeWidth,a=e.spriteSourceSizeY-i*e.sourceSizeHeight,h=a+e.spriteSourceSizeHeight):(n=-s*e.sourceSizeWidth,r=n+e.sourceSizeWidth,a=-i*e.sourceSizeHeight,h=a+e.sourceSizeHeight);const x=n*o+a*c+d,m=n*u+a*l+f,T=n*o+h*c+d,g=n*u+h*l+f,v=r*o+h*c+d,p=r*u+h*l+f,E=r*o+a*c+d,y=r*u+a*l+f;t[0]=x,t[1]=m,t[6]=T,t[7]=g,t[12]=v,t[13]=p,t[18]=E,t[19]=y;const w=this.bounds;w.x=Math.min(x,T,v,E),w.y=Math.min(m,g,p,y),w.right=Math.max(x,T,v,E),w.bottom=Math.max(m,g,p,y)}uploadBuffers(t,e,s,i=!0){this.dirtyRender&&this.updateVertices();const r=this.vertexData,n=this.texture.glIndex;i&&n!==this._prevTextureID&&(this._prevTextureID=n,r[4]=n,r[10]=n,r[16]=n,r[22]=n),t.set(r,s);const h=this.vertexColor;e[s+5]=h[0],e[s+11]=h[2],e[s+17]=h[3],e[s+23]=h[1]}destroy(t){super.destroy(t),this.texture=null,this.frame=null,this.hasTexture=!1,this.vertexData=null,this.vertexColor=null,this.vertexAlpha=null,this.vertexTint=null}get tint(){return this._tint}set tint(t){this._tint=t}}
/**
     * @author       Richard Davey <rich@photonstorm.com>
     * @copyright    2020 Photon Storm Ltd.
     * @license      {@link https://opensource.org/licenses/MIT|MIT License}
     */function S(t){let e;return t&&("string"==typeof t?e=document.getElementById(t):"object"==typeof t&&1===t.nodeType&&(e=t)),e||(e=document.body),e}class b{constructor(t,e,s=!1){this.callback=t,this.context=e,this.once=s}}class _{constructor(){this.textures=new Map,this.createDefaultTextures()}createDefaultTextures(){this.add("__BLANK",new h(t(32,32).canvas));const e=t(32,32);e.strokeStyle="#0f0",e.moveTo(0,0),e.lineTo(32,32),e.stroke(),e.strokeRect(.5,.5,31,31),this.add("__MISSING",new h(e.canvas))}get(t){return this.textures.has(t)?this.textures.get(t):this.textures.get("__MISSING")}has(t){return this.textures.has(t)}add(t,e){let s;return this.textures.has(t)||(s=e instanceof h?e:new h(e),s.key=t,s.glTexture||s.createGL(),this.textures.set(t,s)),s}}const A=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function D(t){let e="";for(let s=0;s<t;++s)s>0&&(e+="\nelse "),s<t-1&&(e+=`if(test == ${s}.0){}`);return e}const F={fragmentShader:"\nprecision highp float;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vTintColor;\n\nuniform sampler2D uTexture[%count%];\n\nvoid main (void)\n{\n    vec4 color;\n    %forloop%\n\n    gl_FragColor = color * vec4(vTintColor.bgr * vTintColor.a, vTintColor.a);\n}",vertexShader:"\nprecision highp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute float aTextureId;\nattribute vec4 aTintColor;\n\nuniform mat4 uProjectionMatrix;\nuniform mat4 uCameraMatrix;\n\nvarying vec2 vTextureCoord;\nvarying float vTextureId;\nvarying vec4 vTintColor;\n\nvoid main (void)\n{\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vTintColor = aTintColor;\n\n    gl_Position = uProjectionMatrix * uCameraMatrix * vec4(aVertexPosition, 0.0, 1.0);\n}"};class C{constructor(t,e={}){this.attribs={aVertexPosition:0,aTextureCoord:0,aTextureId:0,aTintColor:0},this.uniforms={uProjectionMatrix:0,uCameraMatrix:0,uTexture:0},this.dataSize=4,this.indexSize=4,this.vertexElementSize=6,this.vertexByteSize=24,this.quadByteSize=96,this.quadElementSize=24,this.quadIndexSize=6,this.renderer=t,this.gl=t.gl;const{batchSize:s=4096,fragmentShader:i=F.fragmentShader,vertexShader:r=F.vertexShader}=e;this.batchSize=s,this.bufferByteSize=s*this.quadByteSize,this.createBuffers(),this.createShaders(i,r),this.count=0}createBuffers(){let t=[];for(let e=0;e<this.batchSize*this.indexSize;e+=this.indexSize)t.push(e+0,e+1,e+2,e+2,e+3,e+0);this.data=new ArrayBuffer(this.bufferByteSize),this.index=new Uint16Array(t),this.vertexViewF32=new Float32Array(this.data),this.vertexViewU32=new Uint32Array(this.data);const e=this.gl;this.vertexBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.data,e.DYNAMIC_DRAW),this.indexBuffer=e.createBuffer(),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.index,e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),t=[]}createShaders(t,e){const s=this.gl,i=this.renderer.maxTextures;let r="";if(i>1){for(let t=0;t<i;t++)t>0&&(r+="\nelse "),t<i-1&&(r+=`if (vTextureId < ${t}.5)`),r+="\n{",r+=`\n  color = texture2D(uTexture[${t}], vTextureCoord);`,r+="\n}";t=(t=t.replace(/%count%/gi,""+i)).replace(/%forloop%/gi,r)}else r="color = texture2D(uTexture[0], vTextureCoord);";const n=s.createShader(s.FRAGMENT_SHADER);s.shaderSource(n,t),s.compileShader(n);const h=s.createShader(s.VERTEX_SHADER);s.shaderSource(h,e),s.compileShader(h);const a=s.createProgram();s.attachShader(a,h),s.attachShader(a,n),s.linkProgram(a),s.useProgram(a),this.program=a;for(let t of Object.keys(this.attribs)){let e=s.getAttribLocation(a,t);s.enableVertexAttribArray(e),this.attribs[t]=e}for(let t of Object.keys(this.uniforms))this.uniforms[t]=s.getUniformLocation(a,t)}bind(t,e){const s=this.gl,i=this.renderer,r=this.uniforms;s.useProgram(this.program),s.uniformMatrix4fv(r.uProjectionMatrix,!1,t),s.uniformMatrix4fv(r.uCameraMatrix,!1,e),s.uniform1iv(r.uTexture,i.textureIndex),this.bindBuffers(this.indexBuffer,this.vertexBuffer)}bindBuffers(t,e){const s=this.gl,i=this.vertexByteSize,r=this.attribs;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),s.bindBuffer(s.ARRAY_BUFFER,e),s.vertexAttribPointer(r.aVertexPosition,2,s.FLOAT,!1,i,0),s.vertexAttribPointer(r.aTextureCoord,2,s.FLOAT,!1,i,8),s.vertexAttribPointer(r.aTextureId,1,s.FLOAT,!1,i,16),s.vertexAttribPointer(r.aTintColor,4,s.UNSIGNED_BYTE,!0,i,20),this.count=0}draw(t){const e=this.gl,s=t*this.quadByteSize;if(s===this.bufferByteSize)e.bufferData(e.ARRAY_BUFFER,this.data,e.DYNAMIC_DRAW);else{let t=this.vertexViewF32.subarray(0,s);e.bufferSubData(e.ARRAY_BUFFER,0,t)}e.drawElements(e.TRIANGLES,t*this.quadIndexSize,e.UNSIGNED_SHORT,0)}flush(){const t=this.count;return 0!==t&&(this.draw(t),this.prevCount=t,this.count=0,this.renderer.flushTotal++,!0)}}let B=null;function U(){return B}let L=[];let I=800,z=600,M=1;let P={alpha:!1,antialias:!1,depth:!1,premultipliedAlpha:!1};class X{constructor(){this.clearColor=[0,0,0,1],this.flushTotal=0,this.maxTextures=0,this.currentActiveTexture=0,this.startActiveTexture=0,this.tempTextures=[],this.clearBeforeRender=!0,this.optimizeRedraw=!0,this.autoResize=!0,this.contextLost=!1,this.width=I,this.height=z,this.resolution=M,this.setBackgroundColor(0);const t=document.createElement("canvas");t.addEventListener("webglcontextlost",t=>this.onContextLost(t),!1),t.addEventListener("webglcontextrestored",()=>this.onContextRestored(),!1),this.canvas=t,this.initContext(),this.shader=new C(this)}initContext(){const t=this.canvas.getContext("webgl",P);i.set(t),this.gl=t,this.elementIndexExtension=t.getExtension("OES_element_index_uint"),this.getMaxTextures(),this.shader&&(this.shader.gl=t),t.disable(t.DEPTH_TEST),t.disable(t.CULL_FACE),this.resize(this.width,this.height,this.resolution)}resize(t,e,s=1){this.width=t*s,this.height=e*s,this.resolution=s;const i=this.canvas;i.width=this.width,i.height=this.height,this.autoResize&&(i.style.width=this.width/s+"px",i.style.height=this.height/s+"px"),this.gl.viewport(0,0,this.width,this.height),this.projectionMatrix=function(t,e,s=-1,i=1){return new Float32Array([1/-t*-2,0,0,0,0,1/e*-2,0,0,0,0,1/(s-i)*2,0,-1,1,0,1])}(t,e)}onContextLost(t){t.preventDefault(),this.contextLost=!0}onContextRestored(){this.contextLost=!1,this.initContext()}setBackgroundColor(t){const e=this.clearColor,s=t>>16&255,i=t>>8&255,r=255&t,n=t>16777215?t>>>24:255;return e[0]=s/255,e[1]=i/255,e[2]=r/255,e[3]=n/255,this}getMaxTextures(){const t=this.gl;let e=function(t,e){const s=e.createShader(e.FRAGMENT_SHADER);for(;;){const i=A.replace(/%forloop%/gi,D(t));if(e.shaderSource(s,i),e.compileShader(s),e.getShaderParameter(s,e.COMPILE_STATUS))break;t=t/2|0}return t}(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),t);const s=this.tempTextures;s.length&&s.forEach(e=>{t.deleteTexture(e)});for(let i=0;i<e;i++){let e=t.createTexture();t.activeTexture(t.TEXTURE0+i),t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),s[i]=e}this.maxTextures=e,this.textureIndex=Array.from(Array(e).keys()),this.activeTextures=Array(e),this.currentActiveTexture=0}reset(t=null,e=this.width,s=this.height){const i=this.gl;i.bindFramebuffer(i.FRAMEBUFFER,t),i.viewport(0,0,e,s),i.enable(i.BLEND),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),this.currentActiveTexture=0,this.startActiveTexture++,this.flushTotal=0}render(t,e,s){if(this.contextLost)return;const i=this.gl;this.flushTotal;if(this.reset(),this.optimizeRedraw&&0===e&&0===s)return;const r=this.shader,n=this.clearColor;this.clearBeforeRender&&(i.clearColor(n[0],n[1],n[2],n[3]),i.clear(i.COLOR_BUFFER_BIT));const h=this.projectionMatrix;let o;for(let e=0;e<t.length;e+=2){let s=t[e],i=t[e+1];o&&(u=s.worldTransform,c=o.worldTransform,u.a===c.a&&u.b===c.b&&u.c===c.c&&u.d===c.d&&u.tx===c.tx&&u.ty===c.ty)||(r.flush(),r.bind(h,s.matrix),o=s);for(let t=0;t<i.length;t++)a(i[t],this,r,this.startActiveTexture)}var u,c;r.flush()}resetTextures(t){const e=this.gl,s=this.activeTextures;s.fill(null),this.currentActiveTexture=0,this.startActiveTexture++,t&&(s[0]=t,e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,t.glTexture),this.currentActiveTexture=1)}requestTexture(t){const e=this.gl;t.glIndexCounter=this.startActiveTexture,this.currentActiveTexture<this.maxTextures?(this.activeTextures[this.currentActiveTexture]=t,t.glIndex=this.currentActiveTexture,e.activeTexture(e.TEXTURE0+this.currentActiveTexture),e.bindTexture(e.TEXTURE_2D,t.glTexture),this.currentActiveTexture++):(this.shader.flush(),this.resetTextures(t))}}function k(t,e,s){return t.hasOwnProperty(e)?t[e]:s}class N{constructor(){this.sceneIndex=0,this.flush=!1,this.dirtyCameras=0,this.dirtyFrame=0,this.totalFrame=0,this.game=w.get(),this.scenes=new Map,this.renderList=[],this.game.once("boot",()=>this.boot())}boot(){L.forEach(t=>{this.add(t)})}add(t){const e=new t;e.willUpdate&&e.boot.call(e)}init(t,e={}){const s=this.scenes.size,i=this.sceneIndex,r=0===s;"string"==typeof e?t.key=e:(e||!e&&r)&&(t.key=k(e,"key","scene"+i),t.willUpdate=k(e,"willUpdate",r),t.willRender=k(e,"willRender",r)),this.scenes.has(t.key)?console.warn("Scene key already in use: "+t.key):(this.scenes.set(t.key,t),this.flush=!0,this.sceneIndex++)}update(t,e){for(const s of this.scenes.values())s.willUpdate&&(s.update.call(s,t,e),s.world.update(t,e))}render(t){const e=this.renderList;e.length=0,this.dirtyCameras=0,this.dirtyFrame=0,this.totalFrame=0;for(let s of this.scenes.values())if(s.willRender){let i=s.world;if(this.dirtyFrame+=i.render(t),this.totalFrame+=i.totalFrame,0===i.renderList.length)continue;i.camera.dirtyRender&&(this.dirtyCameras++,i.camera.dirtyRender=!1),e.push(i.camera),e.push(i.renderList)}return this.flush&&(this.dirtyFrame++,this.flush=!1),[e,this.dirtyFrame,this.dirtyCameras]}}class G extends class{constructor(){this._events=new Map}on(t,e,s=this,i=!1){if("function"!=typeof e)throw new TypeError("The listener must be a function");const r=new b(e,s,i),n=this._events.get(t);return n?n.add(r):this._events.set(t,new Set([r])),this}once(t,e,s=this){return this.on(t,e,s,!0)}clearEvent(t){return this._events.delete(t),this}eventNames(){return[...this._events.keys()]}listeners(t){const e=[];return this._events.get(t).forEach(t=>{e.push(t.callback)}),e}listenerCount(t){const e=this._events.get(t);return e?e.size:0}emit(t,...e){if(!this._events.has(t))return!1;const s=this._events.get(t);for(const t of s)t.callback.apply(t.context,e),t.once&&s.delete(t);return 0===s.size&&this._events.delete(t),!0}off(t,e,s,i){if(e){const r=this._events.get(t),n=!s,h=void 0!==i;for(const t of r)t.callback===e&&n&&t.context===console&&h&&t.once===i&&r.delete(t);0===r.size&&this._events.delete(t)}else this._events.delete(t);return this}removeAllListeners(t){t?this._events.delete(t):this._events.clear()}}{constructor(...t){super(),this.VERSION="4.0.0-beta1",this.isPaused=!1,this.isBooted=!1,this.lifetime=0,this.elapsed=0,this.frame=0,t.forEach(t=>{t()}),this.cache={json:new Map,csv:new Map,xml:new Map},w.set(this),function(t){const e=document.readyState;if("complete"===e||"interactive"===e)return void t();const s=()=>{document.removeEventListener("deviceready",s,!0),document.removeEventListener("DOMContentLoaded",s,!0),window.removeEventListener("load",s,!0),t()};document.body?window.hasOwnProperty("cordova")?document.addEventListener("deviceready",s,!0):(document.addEventListener("DOMContentLoaded",s,!0),window.addEventListener("load",s,!0)):window.setTimeout(s,20)}(()=>this.boot())}boot(){this.isBooted=!0,this.lastTick=Date.now();const t=new X;var e;U()&&(e=t.canvas,S(U()).appendChild(e)),this.renderer=t,this.textures=new _,this.scenes=new N,this.banner(this.VERSION),document.addEventListener("visibilitychange",()=>{this.emit("visibilitychange",document.hidden),document.hidden?this.pause():this.resume()}),this.emit("boot"),requestAnimationFrame(()=>this.step())}pause(){this.isPaused=!0,this.emit("pause")}resume(){this.isPaused=!1,this.lastTick=Date.now(),this.emit("resume")}banner(t){console.log("%cPhaser v"+t+"%c https://phaser4.io","padding: 4px 16px; color: #fff; background: linear-gradient(#3e0081 40%, #00bcc3)","")}step(){const t=Date.now(),e=(t-this.lastTick)/1e3;this.lifetime+=e,this.elapsed=e,this.lastTick=t,this.emit("step",e,t);const s=this.scenes;this.isPaused||s.update(e,t),this.emit("update",e,t);const[i,r,n]=s.render(this.frame);this.renderer.render(i,r,n),this.emit("render",e,t),this.frame++,requestAnimationFrame(()=>this.step())}destroy(){}}class Y{constructor(t){this.scene=t,this.renderer=t.game.renderer,this.matrix=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this.bounds=new o,this.reset()}reset(){const t=this.renderer.width,e=this.renderer.height;this.width=t,this.height=e,this.bounds.set(0,0,t,e)}destroy(){this.scene=null,this.renderer=null,this.matrix=null,this.bounds=null}}class O{constructor(t){this.dirtyFrame=0,this.totalFrame=0,this.visibleFrame=0,this.forceRefresh=!1,this.scene=t,this.children=[],this.renderList=[],this.worldTransform=new v,this.camera=new Y(t)}scanChildren(t,e){const s=t.children;for(let t=0;t<s.length;t++)this.buildRenderList(s[t],e)}buildRenderList(t,e){t.isRenderable()&&(this.renderList.push(t),t.dirtyFrame>=e&&this.dirtyFrame++,this.visibleFrame++),t.isParent&&t.visible&&this.scanChildren(t,e)}update(t,e){const s=this.children;for(let i=0;i<s.length;i++){let r=s[i];r&&r.willUpdate&&r.update(t,e)}}render(t){return this.dirtyFrame=0,this.visibleFrame=0,this.renderList.length=0,this.scanChildren(this,t),this.totalFrame=this.renderList.length,this.forceRefresh&&(this.dirtyFrame++,this.forceRefresh=!1),this.dirtyFrame}shutdown(){this.renderList=[],this.camera.reset()}destroy(){this.camera.destroy(),this.camera=null,this.renderList=null}get numChildren(){return this.children.length}}class V extends class{constructor(t){this.willUpdate=!1,this.willRender=!1,this.game=w.get(),this.world=new O(this),this.game.scenes.init(this,t)}boot(){}update(){}render(){}shutdown(){}destroy(){this.world.destroy(),this.world=null,this.game=null}}{constructor(){super();const e=function(e="rgba(0,0,0,0)",s=32,i=32){const r=t(s,i);return r.fillStyle=e,r.fillRect(0,0,s,i),new h(r.canvas)}("#f00",64,64),s=new R(200,100,e),i=new R(400,300,e),r=new R(600,500,e);new p;!function(t,...e){e.forEach(e=>{!function(t,...e){e.forEach(e=>{e.parent&&function(t,...e){const s=t.children;e.forEach(t=>{let e=s.indexOf(t);e>-1&&(s.splice(e,1),t.parent=null)})}(e.parent,e),e.scene=t.scene,e.parent=t})}(t,e),t.children.push(e),e.updateTransform()})}(this.world,s,i,r)}}var H,W;console.log("main"),new G(function(t=800,e=600,s=1){return 0===s&&(s=window.devicePixelRatio),()=>{I=t,z=e,M=s}}(800,600),(W="example",()=>{W&&(B=S(W))}),(H=V,()=>{L=[].concat(H)}))}();
//# sourceMappingURL=bundle.js.map
